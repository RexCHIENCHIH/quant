//@version=5
strategy(title="CDP",overlay=true)

//CDP指標計算
PDH = request.security(syminfo.tickerid,"1D",high)
PDC = request.security(syminfo.tickerid,"1D",close)
PDL = request.security(syminfo.tickerid,"1D",low)
type = input.string("逆勢進場", options = ["逆勢進場","順勢進場"])

//關鍵價位
CDP = (PDH+PDL+2*PDC)/4
AH = CDP+(PDH-PDL)
NH = 2*CDP-PDL
NL = 2*CDP-PDH
AL = CDP-(PDH-PDL)

//進場條件
var LongEntry = false
var ShortEntry = false

if type=="逆勢進場"
    LongEntry := ta.crossover(close,NL)
    ShortEntry := ta.crossunder(close,NH)

else if type=="順勢進場"
    LongEntry := ta.crossover(close,AH)
    ShortEntry := ta.crossunder(close,AL)

//多單進場
if LongEntry
    strategy.entry("LE", strategy.long) 

//空單進場
if ShortEntry
    strategy.entry("SE", strategy.short) 

//背景顏色，多頭綠色，空頭紅色，空手灰色
colorBG = strategy.position_size > 0 ? color.new(color.green, 80) :
         strategy.position_size < 0 ? color.new(color.red, 80) :
         color.new(color.gray, 100)
bgcolor(colorBG, force_overlay=true)

//繪圖
plot(AH,"AH",color = color.green)
plot(NH,"NH",color = color.red)
plot(CDP,"CDP",color = color.blue)
plot(NL,"NL",color = color.red)
plot(AL,"AL",color = color.green)
