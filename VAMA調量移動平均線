//@version=5
indicator("VAMA", overlay=true)

//每次收K都清空委託單
strategy.cancel_all()

// 設定參數
Length = input.int(14, title="Length")

//基準成交量：由K棒數量決定
lowest_volume = ta.lowest(volume, Length)

//權重 = 當根K棒成交量 / 基準成交量，相除後所得的倍數即為當根K棒價格的權重
//當根K棒成交量越大，權重越高
weight = volume / lowest_volume

// 計算VAMA = ∑(當根K棒收盤價*權重) / ∑(權重) 
sum_weighted_close = math.sum(close * weight, Length)
sum_weight = math.sum(weight, Length)
VAMA = sum_weighted_close / sum_weight

// 繪製VAMA
plot(VAMA, title="VAMA", color=color.blue,linewidth = 2)
