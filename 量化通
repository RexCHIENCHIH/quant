//@version=5
strategy(title="RSI",shorttitle="RSI",overlay=false)

//MP: 判斷目前是否有持倉。若持有多單，MP 為 1；若持有空單，MP 為 -1；若無持倉，MP 為 0。
MP = strategy.opentrades.size(strategy.opentrades - 1)>0?1:strategy.opentrades.size(strategy.opentrades - 1)<0?-1:0

//RSI指標計算，RSI = 價格上漲總幅度平均值 / (上漲+下跌的總幅度平均值)
rsi_length = input.int(14, minval=1, maxval=1000, step=1, title="RSI長度", group="RSI參數設定")
rsi_Upper = input.int(70, minval=0, maxval=100, step=1, title="RSI上軌", group="RSI參數設定")
rsi_Lower = input.int(30, minval=0, maxval=100, step=1, title="RSI下軌", group="RSI參數設定")

//指標
rsi = ta.rsi(close,rsi_length)

//逆勢進場
BuySignal = ta.crossover(rsi,rsi_Lower)
SellSignal = ta.crossunder(rsi,rsi_Upper)

//順勢進場
BuySignal = ta.crossover(rsi,rsi_Upper)
SellSignal = ta.crossunder(rsi,rsi_Lower)

//多單
if BuySignal
    strategy.entry("Buy", strategy.long) 
//空單
if SellSignal
    strategy.entry("Sell", strategy.short) 

//上底色，持有多單底色綠色，持有空單底色紅色
colorBG = strategy.opentrades.size(strategy.opentrades-1)>0 ? color.new(color.green,80) :
 strategy.opentrades.size(strategy.opentrades-1)<0 ? color.new(color.red,80) :
 color.new(color.gray,100)
bgcolor(colorBG, force_overlay=true)

//定義RSI線條顏色
rsiColor = rsi>=rsiUpper ? color.red :
 rsi<=rsiLower ? color.green : color.blue

//繪圖
plot(rsi, "RSI", color=rsiColor, linewidth=2)
rsiUpperBand = hline(rsiUpper, "RSI上界", color=color.gray)
rsiLowerBand = hline(rsiLower, "RSI下界", color=color.gray)
rsi100Band = hline(100, "RSI_100", color=color.gray,linestyle=hline.style_solid)
rsi50Band = hline(50, "RSI中界", color=color.new(color.gray, 50))
rsi0Band = hline(0, "RSI_0", color=color.gray,linestyle=hline.style_solid)
fill(rsiUpperBand, rsi100Band, color=color.new(color.red,90), title="RSI上界")
fill(rsi0Band, rsiLowerBand, color=color.new(color.green,90), title="RSI下界")
